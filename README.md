# [Are You AI Demo](https://areyouaidemo.com/)

![The front page of the Are You AI? Demo Application](https://github.com/user-attachments/assets/d64211c7-4ced-484a-ad19-7ad9a2af9c5c)


All code and information provided in this repository is made available on an “as-is” basis with the express understanding that Cloudflare has no obligation to monitor, control, maintain or otherwise update the materials. This demo is intended for demonstration purposes only and should not be used for production workloads. Your use of the demo is at your own discretion and risk. Cloudflare makes no claims or promises about the quality, accuracy, or reliability of the demo, its safety or security, or content generated by the demo (if any). Cloudflare is not liable to you for any loss or damage that might arise from your use of the demo.

## How To Deploy The App Yourself

  

Note: This application requires a credit card and you will be charged for Cloudflare Images which does not have a free tier for image storage. All other services have a free tier, but you can incur charges if you go over the free tier. 

  
### Pre-requisites

- A Cloudflare Account
- Cloudflare Wrangler Installed - [Install/Update Wrangler](https://developers.cloudflare.com/workers/wrangler/install-and-update/)
  
### Clone the repository and prepare environments variable file

1. Clone the repository and run `npm i` inside bot the the `/api` directory & `/frontend` directory
2. Prepare the environment variable files:

- Rename the `.dev.vars.TEMPLATE` file inside of `/api` to `.dev.vars`. This is where all the API related environment variables will need to be updated/added. Do not commit this file to your repository. 
-  Rename the `.env.local.TEMPLATE` in `/frontend` folder to `.env.local`. 

### 1. Creating the AI Services (Vectorize & AI Gateway)

#### Create the Vector Database (Vectorize) & Metadata Field**

1. Create your vector database with the following command: `npx wrangler vectorize create are-you-ai --dimensions=768 --metric=cosine`

2. The above command will output to your terminal code that must be added to the `wrangler.toml` within the `/api` directory. It should look like the code snippet below. Ensure that `binding` is equal to `VECTORIZE`.

``` text
[[vectorize]]
binding = "VECTORIZE"
index_name = "vector-index"
```

3. You need to add metadata a metadata field to your Vectorize database. This is used for filtering while querying the database. Use the below command to create a metadata field. This adds a metadata field named `sessionId` which is of type string. For more information review the docs, (Create metadata indexes)[https://developers.cloudflare.com/vectorize/get-started/intro/#4-optional-create-metadata-indexes]

`npx wrangler vectorize create-metadata-index vector-database --property-name=sessionId --type=string`. 

#### Create AI Gateway

1. Follow these steps to [create a new AI Gateway](https://developers.cloudflare.com/ai-gateway/get-started/).
2. After creating a new AI Gateway add the ID of the Gateway into the `.dev.vars` file in the `/api` folder. 
  - For example: `AI_GATEWAY_ID=ai-gateway-id`
  
### 2. Creating  Storage Services (D1)

1. Use the following command to create a Cloudflare D1 database:
`npx wrangler d1 create are-you-ai-db`
2. The above command will output text that needs to be added to the `wrangler.toml` within your `/api` directory. Overwrite the existing `[[d1_database]]` binding with the new output. Ensure the `binding` is set to `DB`

``` text
[[d1_databases]]
binding  =  "DB" 
database_name  =  "are-you-ai-db"
database_id  =  "<unique-ID-for-your-database>"
  ```

3. With the database created, we now need to create a table within that database. The SQL commands for creating the table with the proper field is located in `/api/db-schema.sql`. To execute that SQL, run the following command (depending on where you run this command from you may need to change the location of the .sql file. 
`npx wrangler d1 execute are-you-ai-db --file=./api/db-schema.sql`
  

### 3. Create Media Services

1. Follow these steps to create a Cloudflare API Token. You will need a token that has `Edit` privileges for Images. [Create API Token](https://developers.cloudflare.com/fundamentals/api/get-started/create-token/). Add that API token to your `/api/.dev.vars` file as the `IMAGE_UPLOAD_TOKEN`. 

2. Update the `IMAGE_UPLOAD_URL` variable to have the correct Account ID. Use these docs to find your Account Id: [Find zone and account IDs](https://developers.cloudflare.com/fundamentals/setup/find-account-and-zone-ids/)
